# android | 视图

## 视图

### 相关话题

#### 视图的层次

* layout - layout/view - layout/view - ... - view
* 视图往往是多层次嵌套的

#### 视图刷新

* 视图刷新时，所有层次都需要重新加载一遍
	- 多层次视图：layout - layout/view - layout/view - ... - view
	- 所有层次都需要重新加载一遍
	- 重新加载（创建、初始化、绘制...）是非常耗时耗资源的
* 设备屏幕刷新频率（视图刷新频率）：FPS，frame per second
	- 现在的手机屏幕一般是60Hz的，即每秒刷新60次（60FPS，帧每秒）
	- 也就是每16ms执行一次屏幕刷新
	- 所以进行程序设计时，尽量使得一个多层次视图的完整计算+绘制时间<16ms（针对60FPS的系统）
	- 如果一次绘制过程中，耗时超出16ms,很容易引起“掉帧”现象（即：系统会调过某些帧，相应帧画面丢失）
	- 相关调试工具：todo
	* 备注：以上所讲均是针对屏幕刷新频率==60FPS的设备而言的，如果你想要在支持更高设备刷新频率的设备上做出更好的视觉效果，那么相应的阀值自然也就不是16ms了

#### 图形绘制：坐标系 && 坐标

- 概述：绘图过程中常用两种方式确定坐标位置
	*      方式一，绝对坐标
	*          屏幕左上角是（0,0）
	*          往右是x轴正轴
	*          往下是y轴正轴
	*      方式二，旋转画布
	*          先将画布平移、旋转至待绘制图像中心位置
	*          以坐标系原点开始绘制待绘制图形
	*          保存
	*          重置画布
	*          进行下一轮循环		
			```
				// 画布上原有内容保存
		        canvas.save();
		        // 画布平移
		        canvas.translate(10f,10f);
		        // 画布旋转
		        canvas.rotate(90f);
		        // 以原点为中心绘制目标图案
		        canvas.drawLine(0f,0f,10f,0f,solidLinePaint);
		        // 画布重置（防止之后绘制的图形不正确）
		        canvas.restore();
			```

## 关于自定义视图（概述）

### 需要关注的问题

#### 1. 绘图

1. 相关class

- Canvas：画布
	* 画布旋转
	* 
- Paint：画笔

#### 2. 交互

1. 相关class
	
- TouchEvent：触摸
- Animation：动画

#### 3. 性能

1. 相关class和method

- SurfaceView
	+ 子线程
	+ 支持耗时操作，不会阻塞主线程，不会导致APP失去响应
- onDraw()：绘制相关内容
	+ 要考虑的问题：主线程安全问题
		* 一般的view是直接在主线程（UI线程）中直接绘制的，在主线程中绘制这些普通的view的时候，一定要考虑到主线程安全问题，即：不要将耗时操作放在绘制过程中，否则会导致主线程被阻塞，致使APP无法进行事件分发，无法响应用户的操作，甚至导致程序崩溃退出
	+ 如何解决主线程安全问题，绘制复杂的图形，或者执行耗时较久的计算，又不阻塞主线程，令主线程失去响应
		* 答案很简单，你使用SurfaceView就好了呀
			- SurfaceView是在子线程中进行界面绘制，在这里面执行耗时操作不会阻塞主线程哦

#### 4. 封装

1. 关注点：

- 属性
	+ 自定义view中可以封装自己独有的属性
- 尺寸
	+ 如果你想要你的自定义view支持多种硬件设备，你需要考虑它的通用性
	+ 如果你只是在特定场景下使用该自定义view，那你就不用过多地考虑不同设备上的组件尺寸适配问题



## 附录

### 附录一，每一帧视图渲染时间（性能分析）

#### 方法一，使用移动设备自带的调试工具(HWUI)进行性能分析

1. 调试工具： HWUI
2. 如何打开该调试工具
	 * english: 设置 - 开发者选项 - monitoring - Profile HWUI rendering
	 * 中文：设置 - 开发者选项 - 监控 - GPU呈现模式分析 - 在屏幕上显示为条形图
3. 解析：通过上述工具查看当前view的绘图性能表现
	 * 绿色的线表示每一帧视图加载时间，如60FPS（frame per seconds）的设备,一帧视图的加载时间约为1000 / 60 ~ 16ms
	 * 下面的直方图表示实际每一帧视图加载时间，重点关注绿色部分，
	 * 如果绿色部分高出上面绿色的线条，就说明你的当前activity需要改进，你需要降低相应视图中计算复杂度、图形绘制复杂度等，从而降低整个activity加载时间
	 * 防止实际加载时间超出上限（上方的绿色线条），出现“掉帧”现象
